---
title: "Nachhaltige Orte Gießen"
format:
  html: 
    toc: false
    theme: 
      - cosmo
      - custom.scss
---

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(crosstalk)
library(leaflet)
library(dplyr)

# define functions for Map-Markers
getColor <- function(locations) {
  sapply(locations$type, function(type) {
    case_when(
      type == "Garten" ~ "green",
      type == "Gastronomie" ~ "orange",
      type == "Shop" ~ "lightblue",
      type == "Teilen" ~ "purple",
      TRUE ~ "red"
    )
  })
}

getIcon <- function(locations) {
  sapply(locations$type, function(type) {
    case_when(
      type == "Garten" ~ "leaf",
      type == "Gastronomie" ~ "restaurant",
      type == "Shop" ~ "cart",
      type == "Teilen" ~ "contract",
      TRUE ~ "xmark"
    )
  })
}

# load data
locations <- read.csv("locations.csv") %>% 
  mutate(type = factor(type)) %>% 
  mutate(ID = row_number())
  
# create shared data for crosstalk
shared_locations <- SharedData$new(locations, key = ~ID)

# implement filter
bscols(
  widths = c(1,5,5,1), 
  list(),
  filter_select(
    id = "location_filter",
    label = "Filter Ortstyp",
    sharedData = shared_locations,
    group = ~type,
    allLevels = TRUE,
    multiple = TRUE
  )
)

# get icons
icons <- awesomeIcons(
  icon = getIcon(locations),
#  icon = "leaf",
  iconColor = "black",
  library = "ion",
  markerColor = getColor(locations)
#  markerColor = "green"
)

# create Map
leaflet(shared_locations) %>% 
  addTiles() %>%
  setView(lng = 8.6731, lat = 50.5867, zoom = 13) %>% 
  addAwesomeMarkers(
    lng = ~longitude,
    lat = ~latitude,
    icon=icons,
    popup = ~paste("<strong>", name, "</strong><br>", description, "<br><em>Type:</em> ", type)
  ) %>% 
  addEasyButton(easyButton(
    icon="fa-map", title="Standardansicht - Gießen",
    onClick=JS("function(btn, map){ map.setView([50.5867, 8.6731], 13);}"))) %>%
  addEasyButton(easyButton(
    icon="fa-crosshairs", title="Mein Standort",
    onClick=JS("function(btn, map){ map.locate({setView: true}); }")))



```
